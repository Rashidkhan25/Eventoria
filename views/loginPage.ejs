<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Eventoria | User Login</title>
    <link rel="stylesheet" href="/css/output.css">
    <link rel="stylesheet" href="/css/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

    <style>
      body { font-family: 'Inter', sans-serif; }

      .background-image {
        background: url('/images/back.png') no-repeat center center;
        background-size: cover;
        position: fixed; top: 0; left: 0;
        height: 100vh; width: 100vw; z-index: -2;
      }

      .background-blur {
        backdrop-filter: blur(2px);
        background-color: rgba(0, 0, 0, 0.4);
        position: fixed; top: 0; left: 0;
        height: 100vh; width: 100vw; z-index: -1;
      }

      @keyframes loginFade {
        from { opacity: 0; transform: scale(0.8) translateY(50px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
      }
      .login-animate { animation: loginFade 1s ease-out forwards; }

      @keyframes crazyExit {
        0% { transform: perspective(800px) rotateY(0) scale(1); opacity: 1; }
        50% { transform: perspective(800px) rotateY(90deg) scale(1.2); opacity: 0.6; }
        100% { transform: perspective(800px) rotateY(180deg) scale(0.3); opacity: 0; }
      }
      .submit-animate { animation: crazyExit 1.2s ease-in-out forwards; }

      .close-btn {
        position: absolute; top: 1rem; right: 2rem;
        font-size: 1.75rem; color: white;
        border: none; cursor: pointer; z-index: 20;
        background: transparent;
      }
      .close-btn:hover { color: #3b82f6; transform: scale(1.2); }

      .input-field {
        width:100%;
        padding:0.75rem 1rem;
        border-radius:0.5rem;
        background: rgba(13,42,69,0.45);
        border:1px solid rgba(99,102,241,0.08);
        color:white;
      }

      .google-btn {
        display:flex; align-items:center; justify-content:center; gap:8px;
        background:white; color:black; padding:10px; border-radius:999px;
        width:100%; cursor:pointer; font-weight:600;
      }
    </style>
  </head>

  <body class="min-h-screen flex items-center justify-center relative">
    <div id="navbar" class="fixed top-0 m-6 inset-x-0 z-50 transition-all duration-700 bg-transparent font-general">
      <nav class="flex items-center justify-between px-6 py-4">
        <!-- Logo -->
         <div class="flex items-center gap-3">
          <span class="text-white font-saonara text-4xl">Eventoria</span>
        </div>
      </nav>
    </div>

    <div class="background-image"></div>
    <div class="background-blur"></div>

    <div
      class="relative bg-black/60 backdrop-blur-lg p-10 rounded-md shadow-2xl border border-blue-700 
             w-full max-w-md text-white login-animate"
      id="user-login-box"
    >
      <button class="close-btn" onclick="window.location.href='/home'">&times;</button>

      <h2 class="text-4xl font-extrabold mb-6 text-center tracking-wide">User Login</h2>

      <form id="userLoginForm" class="space-y-5">

        <input
          type="email"
          name="useremail"
          placeholder="Email Address"
          required
          class="input-field"
        />

        <input
          type="password"
          name="password"
          placeholder="Password"
          required
          class="input-field"
        />

        <button
          id="userSubmitButton"
          type="button"
          class="px-4 py-2 bg-blue-700 text-white rounded-[2.5rem] 
                 hover:bg-blue-600 transition w-full"
        >
          <span>Login</span>
        </button>

        <div class="flex items-center gap-3">
          <div class="h-px bg-white/10 flex-1"></div>
          <p class="text-sm text-blue-300">or</p>
          <div class="h-px bg-white/10 flex-1"></div>
        </div>

        <button id="googleLogin" type="button" class="google-btn">
          <img src="https://www.svgrepo.com/show/475656/google-color.svg" width="20" />
          Login with Google
        </button>

        <div class="text-sm text-blue-300 mt-3 text-center">
          <a href="/usersignup" class="hover:underline">Create New Account</a>
        </div>

      </form>

      <div class="mt-8 text-sm text-blue-300 text-center">
        <a href="/hostlogin" class="text-blue-400 font-medium hover:underline">Are you a Host?</a>
      </div>
    </div>

    <!-- Firebase Login -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        GoogleAuthProvider,
        signInWithPopup
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCgQhUe2F6T59chhkPDHZ0QgjPJpe6Pz_0",
        authDomain: "eventoria-9da08.firebaseapp.com",
        projectId: "eventoria-9da08",
        storageBucket: "eventoria-9da08.firebasestorage.app",
        messagingSenderId: "1081916400444",
        appId: "1:1081916400444:web:f28cd875473e04b5bd3439"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      async function sendIdTokenToServer(idToken) {
        await fetch("/sessionLogin", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ idToken })
        });
      }

      // EMAIL + PASSWORD LOGIN
      document.getElementById("userSubmitButton").addEventListener("click", async () => {
        const email = document.querySelector("input[name='useremail']").value.trim();
        const password = document.querySelector("input[name='password']").value;

        if (!email || !password) return alert("Enter all fields");

        try {
          const userCred = await signInWithEmailAndPassword(auth, email, password);
          const idToken = await userCred.user.getIdToken();
          await sendIdTokenToServer(idToken);

          document.getElementById("user-login-box").classList.add("submit-animate");
          setTimeout(() => window.location.href = "/home", 900);

        } catch (err) {
          alert(err.message);
        }
      });

      // GOOGLE LOGIN
      document.getElementById("googleLogin").addEventListener("click", async () => {
        try {
          const result = await signInWithPopup(auth, provider);
          const idToken = await result.user.getIdToken();
          await sendIdTokenToServer(idToken);

          document.getElementById("user-login-box").classList.add("submit-animate");
          setTimeout(() => window.location.href = "/home", 900);

        } catch (err) {
          console.error(err);
          alert("Google login failed");
        }
      });
    </script>

  </body>
</html>
